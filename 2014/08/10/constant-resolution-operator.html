<!DOCTYPE html>
<!--[if IE 9]><html class="lt-ie10" lang="en" prefix="og: http://ogp.me/ns#"> <![endif]-->
<html class="no-js" lang="en" prefix="og: http://ogp.me/ns#">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  


  <title>Ruby Constant Resolution Operator (::)</title>
  <meta property="og:title" content="Ruby Constant Resolution Operator (::)" />



  



  <meta name="description" content="I came across ::ENV and ENV when I was reading the Figaro gem.  I was not able to articulate the difference between the two, so I set out to find more about the constant resolution operator (::).  Hopefully this will be useful for others as well.
" />
  <meta property="og:description" content="I came across ::ENV and ENV when I was reading the Figaro gem.  I was not able to articulate the difference between the two, so I set out to find more about the constant resolution operator (::).  Hopefully this will be useful for others as well.
" />


<link rel="canonical" href="http://serixscorpio.github.io/2014/08/10/constant-resolution-operator.html" />
<meta property="og:url" content="http://serixscorpio.github.io/2014/08/10/constant-resolution-operator.html" />
<meta property="og:site_name" content="Random Walks in Gems" />

<meta property="og:updated_time" content="2014-08-10T00:00:00+00:00" />






  <meta property="keywords" content="blog,personal" />
















  <link type="text/plain" rel="author" href="humans.txt" />
  <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.5.0/webfont.js"></script>
  <link rel="stylesheet" href="http://serixscorpio.github.io/assets/app-b03a128dc9c29006ca25e435f5fc25b9.css">
  <script>(function(){"use strict";WebFont.load({google:{families:["Ubuntu"]}})}).call(this);</script>
  <script src="http://serixscorpio.github.io/assets/head-20ade4d99b635d94e5ec57b12ffc9c92.js"></script>
</head>

<body>

  <article>
  <header class="hero">
    <h1>Ruby Constant Resolution Operator (::)</h1>
    <p>10 Aug 2014</p>
  </header>

  <div class="container">
    <div class="row section-content">
      <div class="large-10 large-offset-1 columns">
        <p>I came across <code>::ENV</code> and <code>ENV</code> when I was reading the Figaro gem.  I was not able to articulate the difference between the two, so I set out to find more about the constant resolution operator (::).  Hopefully this will be useful for others as well.</p>

<p>Let&#39;s play around with it in irb (or alternatively, pry), to get a feel of what we are dealing with:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">[1] pry(main)&gt; ENV
=&gt; {&quot;CLUTTER_IM_MODULE&quot;=&gt;&quot;xim&quot;,
 &quot;COLUMNS&quot;=&gt;&quot;119&quot;,
 &quot;DBUS_SESSION_BUS_ADDRESS&quot;=&gt;&quot;unix:abstract=/tmp/dbus-o7ga8nDMeL&quot;,
 &quot;DEFAULTS_PATH&quot;=&gt;&quot;/usr/share/gconf/Lubuntu.default.path&quot;,
 ...
 &quot;XMODIFIERS&quot;=&gt;&quot;@im=ibus&quot;,
 &quot;ZSH&quot;=&gt;&quot;/home/eric/.oh-my-zsh&quot;,
 &quot;_LXSESSION_PID&quot;=&gt;&quot;1689&quot;}
[2] pry(main)&gt; 
</code></pre></div>
<p>It looks like <code>ENV</code> has all of my environment variables already.  So I suspect this is built into Ruby already.  Indeed, this is the <a href="http://www.ruby-doc.org/core-2.1.2/ENV.html">ENV class documentation</a>.  Then I tried:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">[2] pry(main)&gt; ::ENV
=&gt; {&quot;CLUTTER_IM_MODULE&quot;=&gt;&quot;xim&quot;,
 &quot;COLUMNS&quot;=&gt;&quot;119&quot;,
 &quot;DBUS_SESSION_BUS_ADDRESS&quot;=&gt;&quot;unix:abstract=/tmp/dbus-o7ga8nDMeL&quot;,
 &quot;DEFAULTS_PATH&quot;=&gt;&quot;/usr/share/gconf/Lubuntu.default.path&quot;,
...
 &quot;XMODIFIERS&quot;=&gt;&quot;@im=ibus&quot;,
 &quot;ZSH&quot;=&gt;&quot;/home/eric/.oh-my-zsh&quot;,
 &quot;_LXSESSION_PID&quot;=&gt;&quot;1689&quot;}
[3] pry(main)&gt;
</code></pre></div>
<p>It seems like we are getting the same output for both <code>ENV</code> and <code>::ENV</code>.  What does the <code>::</code> do?  The clearest explanation I can find is an excerpt from Dave Thomas and Andy Hunt&#39;s <a href="http://ruby-doc.com/docs/ProgrammingRuby/">Programming Ruby - The Pragmatic Programmer&#39;s Guide</a> -&gt; The Ruby Language (section) -&gt; Scope of Constants and Variables (sub-section):</p>

<p><strong>&quot;Constants defined outside any class or module may be accessed unadorned or by using the scope operator <code>::</code> with no prefix.&quot;</strong></p>

<p>But wait, we just confirmed that <code>ENV</code> is a Ruby core class.  Is it also a constant? Yes, in Ruby, <a href="http://rubylearning.com/satishtalim/ruby_names.html">class names and module names are constants</a>.   Let&#39;s confirm that:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">[3] pry(main)&gt; Object.constants
=&gt; [:Object,
 :Module,
 :Class,
 ...
 :ENV,
 ...
 :RUBYGEMS_ACTIVATION_MONITOR]
[4] pry(main)&gt; 
</code></pre></div>
<p><code>ENV</code> is indeed one of <code>Object</code>&#39;s constants.</p>

<p>So far, we still have not figured out why the Figaro gem uses <a href="https://github.com/laserlemon/figaro/blob/master/lib/figaro/env.rb#L33"><code>::ENV</code></a> instead of <code>ENV</code> to access the Ruby built-in <code>ENV</code> class:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">module Figaro
  module ENV
    extend self
    # ...
    def has_key?(key)
      ::ENV.any? { |k, _| k.downcase == key }
    end
    # ...
  end
end
</code></pre></div>
<p>Could it be because Figaro also defines it&#39;s own module named <code>ENV</code>?  To test this out, let&#39;s use a custom made example:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">[1] pry(main)&gt; module MyModule
[1] pry(main)*   module ENV
[1] pry(main)*     extend self
[1] pry(main)*     def envvar(name)
[1] pry(main)*       ::ENV.fetch(name)
[1] pry(main)*     end  
[1] pry(main)*   end  
[1] pry(main)* end  
=&gt; :envvar
[2] pry(main)&gt; MyModule::ENV.envvar(&quot;HOME&quot;)
=&gt; &quot;/home/eric&quot;
[3] pry(main)&gt;
</code></pre></div>
<p><code>::ENV</code> from the above example is using Ruby&#39;s built-in class, which knows about the <a href="http://www.ruby-doc.org/core-2.1.2/ENV.html">fetch</a> method.  Now let&#39;s try:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">[3] pry(main)&gt; module MyModule
[3] pry(main)*   module ENV
[3] pry(main)*     extend self
[3] pry(main)*     def envvar(name)
[3] pry(main)*       ENV.fetch(name)
[3] pry(main)*     end  
[3] pry(main)*   end  
[3] pry(main)* end  
=&gt; :envvar
[4] pry(main)&gt; MyModule::ENV.envvar(&quot;HOME&quot;)
NoMethodError: undefined method `fetch&#39; for MyModule::ENV:Module
from (pry):14:in `envvar&#39;
[5] pry(main)&gt; 
</code></pre></div>
<p>Here, <code>ENV</code> resolves to <code>MyModule::ENV</code>, which does not know about the <code>fetch</code> method.  How come <code>ENV</code> does not resolve to the built-in Ruby <code>ENV</code> class?  Based on <a href="http://stackoverflow.com/questions/5032844/ruby-what-does-prefix-do">Stackoverflow Q&amp;A</a>, 
the prefix <code>::</code> refers to the global scope, so <code>::ENV</code> resolves to the build-in Ruby <code>ENV</code> class.  Without the prefix, <code>ENV</code> resolves to <code>MyModule::ENV</code> because when Ruby tries to resolve a constant, it begins searching within the current module or class, and continues searching the enclosing scope.  (For more details, check out <a href="http://valve.github.io/blog/2013/10/26/constant-resolution-in-ruby/">@valve&#39;s article</a>)</p>


        
      </div>
    </div>
  </div>
</article>


  <footer>
    

  </footer>




  <script>    'use strict';    yepnope([          {        load: 'https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js',        complete: function () {          if ( !window.jQuery ) {            yepnope('http://serixscorpio.github.io/assets/jquery/dist/jquery-fc13c39852cdf78bcdc4828979ea36d2.js');          }        }      },          'http://serixscorpio.github.io/assets/app-c98f6bcc94867897539baf456375fdab.js'    ]);              </script>
</body>
</html>
